<app-page>
  <ng-container stickyToolBar>
    <div class="app-width" style="padding-top: 1.5vh; padding-bottom: 1.5vh;" fxLayout="row">
      <div fxFlex>
        <a (click)="onBack()" style="color: #48afe5">
          <mat-icon inline="true">arrow_back</mat-icon> Back to TRM home
        </a>
      </div>
      <div>
        <button mat-raised-button (click)="onPrint()">Print</button>
      </div>
    </div>
  </ng-container>
  <div class="ticket-info">
    <app-ticket-status [dispute]="lastUpdatedDispute" *ngIf="lastUpdatedDispute"></app-ticket-status>
    <div *ngIf="conflict === true">
      <span>
        <h3>This ticket is already assigned.</h3>
      </span>
    </div>
    <div *ngIf="conflict === false && !initialDisputeValues && retrieving === false">
      <span>
        <h3>Error retrieving ticket information.</h3>
      </span>
    </div>
    <div *ngIf="conflict === false && retrieving === true">
      <span>
        <h3>Retrieving ticket information...</h3>
      </span>
    </div>
    <div class="ticket-info-section" *ngIf="initialDisputeValues && conflict === false">
      <mat-expansion-panel [expanded]="true"
        *ngIf="lastUpdatedDispute.emailAddressVerified === true || !(lastUpdatedDispute.emailAddress)">
        <mat-expansion-panel-header (click)="handleCollapse('ticketInformation')">
          <app-page-header>
            <ng-container subHeader>
              <span>Ticket Information </span>
              <i *ngIf="collapseObj?.ticketInformation" class="fa fa-minus-circle"></i>
              <i *ngIf="!collapseObj?.ticketInformation" class="fa fa-plus-circle"></i>
            </ng-container>
          </app-page-header>
        </mat-expansion-panel-header>
        <div class="ticket-body">
          <div style="display: flex; justify-content: space-evenly">
            <section class="mb-2 img-section" style="width: 20%">
              <ng-container subHeader>
                <h3>Ticket Image</h3>
              </ng-container>
              <div width="150 !important" *ngIf="imageToShow">
                <img [src]="imageToShow" width="150" height="200" (click)="onExpandTicketImage()" class="ticket-image"><br />
                <span style="font-size:10px; color:#009cde; align-content: center;" width="150" (click)="onExpandTicketImage()" class="ticket-image">
                  <i class="fa fa-plus-circle" style="font-size:18px; color:#009cde"></i>
                  <strong> Click to expand ticket image</strong>
                </span>
              </div>
            </section>
            <section class="ticket-section-form" class="mb-2" style="width:48%">
              <form (ngSubmit)="onSubmitViolationTicket()" [formGroup]="form" novalidate>
                <div formGroupName="violationTicket">
                  <div class="row">
                    <ng-container subHeader>
                      <span>
                        <h3>Violation Ticket Details</h3>
                      </span>
                    </ng-container>
                    <section>
                      <div class="row">
                        <!-- Violation Ticket Number -->
                        <div class="col-lg-4">
                          <mat-form-field class="w-100 mb-2"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('ticket_number'), 'overErrThreshold': applyOverErrThreshold('ticket_number')}">
                            <mat-label>Ticket number</mat-label>
                            <input formControlName="ticketNumber" matInput type="text" oninput="this.value = this.value.toUpperCase()" mask="SS00000000" autocomplete="off"
                              [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('ticketNumber').hasError('required')">
                              {{ "error.required" | translate }}
                            </mat-error>
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('ticketNumber').value && form.get('violationTicket').get('ticketNumber').hasError('mask')">
                              This ticket number is not valid. It must be 2 letters and 8 numbers.
                            </mat-error>
                          </mat-form-field>
                        </div>

                        <!-- Violation Date -->
                        <div class="col-lg-4">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('violation_date'), 'overErrThreshold': applyOverErrThreshold('violation_date')}">
                            <mat-label>Date</mat-label>
                            <input matInput type="date" placeholder="yyyy-MM-DD" formControlName="violationDate" [max]="todayDate" [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('violationDate').hasError('required')">
                              {{ "error.required" | translate }}
                            </mat-error>
                          </mat-form-field>
                        </div>

                        <!-- Violation Time -->
                        <div class="col-lg-4">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('violation_time'), 'overErrThreshold': applyOverErrThreshold('violation_time')}">
                            <mat-label>Time</mat-label>
                            <input matInput type="text" mask="00:00" formControlName="violationTime" [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('violationTime').hasError('required')">
                              {{ "error.required" | translate }}
                            </mat-error>
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('violationTime').hasError('pattern')">
                              Invalid time. Use 24hr format.
                            </mat-error>
                          </mat-form-field>
                        </div>
                      </div>
                    </section>
                    <section>
                      <ng-container subHeader>
                        <span>
                          <h3>Personal Information</h3>
                        </span>
                      </ng-container>
                      <div class="row">

                        <!-- Violation Ticket Surname -->
                        <div class="col-lg-6">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('disputant_surname'), 'overErrThreshold': applyOverErrThreshold('disputant_surname')}">
                            <mat-label>Surname</mat-label>
                            <input matInput formControlName="disputantSurname" [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('disputantSurname').hasError('required')">
                              {{ "error.required" | translate }}
                            </mat-error>
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('disputantSurname').hasError('maxlength')">
                              {{ "error.max_length" | translate }}30
                            </mat-error>
                          </mat-form-field>
                        </div>

                        <!-- Violation Ticket Given names -->
                        <div class="col-lg-6">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('disputant_given_names'), 'overErrThreshold': applyOverErrThreshold('disputant_given_names')}">
                            <mat-label>Given name(s)</mat-label>
                            <input matInput formControlName="disputantGivenNames" [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('disputantGivenNames').hasError('required')">
                              {{ "error.required" | translate }}
                            </mat-error>
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('disputantGivenNames').hasError('maxlength')">
                              {{ "error.max_length" | translate }}30 per name
                            </mat-error>
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="row">
                        <!-- Violation Ticket Province/State of driver's licence -->
                        <div class="col-lg-6">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('drivers_licence_province'), 'overErrThreshold': applyOverErrThreshold('drivers_licence_province')}">
                            <mat-label>Prov/State of DL</mat-label>
                            <mat-select formControlName="driversLicenceProvince" (selectionChange)="onViolationTicketDLProvinceChange($event.value)" [readonly]="isTicketInformationReadOnly">
                              <mat-option [value]=null></mat-option>
                              <mat-option [value]="bc.provAbbreviationCd">{{bc.provNm}}</mat-option>
                              <mat-option *ngFor="let province of provinces" [value]="province.provAbbreviationCd">{{
                                province.provNm }}
                              </mat-option>
                              <mat-option *ngFor="let state of states" [value]="state.provAbbreviationCd">{{
                                state.provNm }}
                              </mat-option>
                            </mat-select>
                            <mat-error *ngIf="!isTicketInformationReadOnly">{{ "error.required" | translate }}</mat-error>
                          </mat-form-field>
                        </div>

                        <!-- Violation Ticket Drivers Licence Number -->
                        <div class="col-lg-6">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('drivers_licence_number'), 'overErrThreshold': applyOverErrThreshold('drivers_licence_number')}">
                            <mat-label>DL number</mat-label>
                            <input matInput formControlName="disputantDriversLicenceNumber"
                              (keypress)="($event.charCode >= 48 && $event.charCode < 58)" minlength="7" maxlength="9"
                              autocomplete="off" [readonly]="isTicketInformationReadOnly"
                              *ngIf="form.get('violationTicket').get('driversLicenceProvince').value === bc.provAbbreviationCd" />
                            <input matInput formControlName="disputantDriversLicenceNumber" autocomplete="off"
                              *ngIf="form.get('violationTicket').get('driversLicenceProvince').value !== bc.provAbbreviationCd"
                              [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly && form.get('violationTicket').get('disputantDriversLicenceNumber').hasError('required')">
                              {{ "error.required" | translate }}
                            </mat-error>
                            <mat-error *ngIf="!isTicketInformationReadOnly && (form.get('violationTicket').get('disputantDriversLicenceNumber')?.errors?.minlength || form.get('violationTicket').get('disputantDriversLicenceNumber').hasError('maxlength'))">
                              Must be a valid BC driver's licence number of seven to nine digits
                            </mat-error>
                          </mat-form-field>
                        </div>
                      </div>
                    </section>
                    <section>
                      <ng-container subHeader>
                        <span>
                          <h3>Count 1</h3>
                        </span>
                      </ng-container>
                      <div class="row" formGroupName="violationTicketCount1">
                        <!-- Violation Ticket Count 1 Description -->
                        <div class="col-lg-8">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('counts.count_no_1.section'), 'overErrThreshold': applyOverErrThreshold('counts.count_no_1.section')}">
                            <mat-label>{{ "label.act_sect_desc" | translate}}</mat-label>
                            <input matInput formControlName="fullDescription" [matAutocomplete]="auto"
                              (keyup)="onFullDescription1Keyup()" (change)="onChangeCount(1, $event.target.value)"
                              [matTooltip]="form.get('violationTicket').get('violationTicketCount1').get('fullDescription').value"
                              [readonly]="isTicketInformationReadOnly" />
                            <mat-autocomplete #auto="matAutocomplete" panelWidth="750"
                              (optionSelected)="onChangeCount(1, $event.option.value)">
                              <mat-option
                                [value]="getCountLegalParagraphing(1, initialDisputeValues.violationTicket)">{{
                                getCountLegalParagraphing(1, initialDisputeValues.violationTicket) }}</mat-option>
                              <mat-option *ngFor="let statute of filteredCount1Statutes"
                                [value]="statute.__statuteString">
                                {{ statute.__statuteString }}</mat-option>
                            </mat-autocomplete>
                            <mat-error *ngIf="!isTicketInformationReadOnly">{{ "error.required" | translate }}</mat-error>
                            <mat-hint *ngIf="!isTicketInformationReadOnly && !isStatuteValid(1)" style="color:red; font-weight: bold;">Invalid statute selection.</mat-hint>
                          </mat-form-field>
                        </div>
                        <!-- Violation Ticket Count 1 Fine Amount -->
                        <div class="col-lg-4">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('counts.count_no_1.ticketed_amount'), 'overErrThreshold': applyOverErrThreshold('counts.count_no_1.ticketed_amount')}">
                            <mat-label>Fine amount ($)</mat-label>
                            <input matInput formControlName="ticketedAmount" [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly">{{ "error.required" | translate }}</mat-error>
                          </mat-form-field>
                        </div>
                      </div>
                    </section>
                    <section>
                      <ng-container subHeader>
                        <span>
                          <h3>Count 2</h3>
                        </span>
                      </ng-container>
                      <div class="row" formGroupName="violationTicketCount2">
                        <!-- Violation Ticket Count 2 Full Description -->
                        <div class="col-lg-8">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('counts.count_no_2.section'), 'overErrThreshold': applyOverErrThreshold('counts.count_no_2.section')}">
                            <mat-label>{{ "label.act_sect_desc" | translate}}</mat-label>
                            <input matInput formControlName="fullDescription" [matAutocomplete]="auto2"
                              [matTooltip]="form.get('violationTicket').get('violationTicketCount2').get('fullDescription').value"
                              (change)="onChangeCount(2, $event.target.value)" (keyup)="onFullDescription2Keyup()"
                              [readonly]="isTicketInformationReadOnly" />
                            <mat-autocomplete #auto2="matAutocomplete" panelWidth="750"
                            (optionSelected)="onChangeCount(2, $event.option.value)">
                            <mat-option
                            [value]="getCountLegalParagraphing(2, initialDisputeValues.violationTicket)">{{
                              getCountLegalParagraphing(2, initialDisputeValues.violationTicket) }}</mat-option>
                              <mat-option *ngFor="let statute of filteredCount2Statutes"
                              [value]="statute.__statuteString">
                              {{ statute.__statuteString }}</mat-option>
                            </mat-autocomplete>
                            <mat-error *ngIf="!isTicketInformationReadOnly">{{ "error.required" | translate }}</mat-error>
                            <mat-hint *ngIf="!isTicketInformationReadOnly && !isStatuteValid(2)" style="color:red; font-weight: bold;">Invalid statute selection.</mat-hint>
                          </mat-form-field>
                        </div>
                        <!-- Violation Ticket Count 2 Fine Amount -->
                        <div class="col-lg-4">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('counts.count_no_2.ticketed_amount'), 'overErrThreshold': applyOverErrThreshold('counts.count_no_2.ticketed_amount')}">
                            <mat-label>Fine amount ($)</mat-label>
                            <input matInput formControlName="ticketedAmount" [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly">{{ "error.required" | translate }}</mat-error>
                          </mat-form-field>
                        </div>
                      </div>
                    </section>
                    <section>
                      <ng-container subHeader>
                        <span>
                          <h3>Count 3</h3>
                        </span>
                      </ng-container>
                      <div class="row" formGroupName="violationTicketCount3">
                        <!-- ViolationTicket Count 3 Full Description -->
                        <div class="col-lg-8">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('counts.count_no_3.section'), 'overErrThreshold': applyOverErrThreshold('counts.count_no_3.section')}">
                            <mat-label>{{ "label.act_sect_desc" | translate}}</mat-label>
                            <input matInput formControlName="fullDescription" [matAutocomplete]="auto3"
                              [matTooltip]="form.get('violationTicket').get('violationTicketCount3').get('fullDescription').value"
                              (change)="onChangeCount(3, $event.target.value)" (keyup)="onFullDescription3Keyup()"
                              [readonly]="isTicketInformationReadOnly" />
                            <mat-autocomplete #auto3="matAutocomplete" panelWidth="750"
                              (optionSelected)="onChangeCount(3, $event.option.value)">
                              <mat-option
                                [value]="getCountLegalParagraphing(3, initialDisputeValues.violationTicket)">{{
                                getCountLegalParagraphing(3, initialDisputeValues.violationTicket) }}</mat-option>
                              <mat-option *ngFor="let statute of filteredCount3Statutes"
                                [value]="statute.__statuteString">
                                {{ statute.__statuteString }}</mat-option>
                            </mat-autocomplete>
                            <mat-error *ngIf="!isTicketInformationReadOnly">{{ "error.required" | translate }}</mat-error>
                            <mat-hint *ngIf="!isTicketInformationReadOnly && !isStatuteValid(3)" style="color:red; font-weight: bold;">Invalid statute selection.</mat-hint>
                          </mat-form-field>
                        </div>
                        <!-- Violation Ticket Count 3 Ticketed Amount -->
                        <div class="col-lg-4">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('counts.count_no_3.ticketed_amount'), 'overErrThreshold': applyOverErrThreshold('counts.count_no_3.ticketed_amount')}">
                            <mat-label>Fine amount ($)</mat-label>
                            <input matInput formControlName="ticketedAmount" [readonly]="isTicketInformationReadOnly" />
                            <mat-error *ngIf="!isTicketInformationReadOnly">{{ "error.required" | translate }}</mat-error>
                          </mat-form-field>
                        </div>
                      </div>
                    </section>
                    <section>
                      <ng-container subHeader>
                        <span>
                          <h3>Court Location</h3>
                        </span>
                      </ng-container>
                      <div class="row">
                        <!-- Provincial Court Hearing Location -->
                        <div class="col-lg-9">
                          <mat-form-field class="w-100"
                            [ngClass]="{'underErrThreshold': applyUnderErrThreshold('court_location'), 'overErrThreshold': applyOverErrThreshold('court_location')}">
                            <mat-select [formControl]="form.get('violationTicket').get('courtLocation')" [readonly]="isTicketInformationReadOnly">
                              <mat-option [value]="initialDisputeValues.violationTicket.courtLocation">{{
                                initialDisputeValues.violationTicket.courtLocation }}</mat-option>
                              <mat-option *ngFor="let courtLocation of lookupsService.courthouseAgencies"
                                [value]="courtLocation.name">{{
                                courtLocation.name }}</mat-option>
                            </mat-select>
                            <mat-error *ngIf="!isTicketInformationReadOnly">{{ "error.required" | translate }}</mat-error>
                          </mat-form-field>
                        </div>
                      </div>
                    </section>
                  </div>
                </div>
                <div style="float: right; width: 100%;" class="row">
                  <button class="large" mat-flat-button type="submit" color="primary" (click)="onValidateClick()"
                    style="background-color: #2ba242;"
                    [disabled]="form.get('violationTicket').invalid || lastUpdatedDispute.status !== DispStatus.New || form.get('violationTicket').touched || !isStatuteValid(1) || !isStatuteValid(2) || !isStatuteValid(3)">
                    Validate
                  </button>
                  <button class="large" mat-flat-button type="submit" color="primary"
                    [disabled]="!(form.get('violationTicket').touched) || form.get('violationTicket').invalid || !isStatuteValid(1) || !isStatuteValid(2) || !isStatuteValid(3)">
                    Save
                  </button>
                </div>
              </form>
            </section>
            <section class="mb-2" style="width:20%">
              <form [formGroup]="flagsForm" novalidate>
                <ng-container subHeader>
                  <h3>Citizen flags</h3>
                </ng-container>
                <div class="col-lg-12 mat-form-field-flex.ng" style="background-color: rgba(0,0,0,0.04)">
                  {{ flagsForm.get('disputantOcrIssues').value ?
                  flagsForm.get('disputantOcrIssues').value : 'None' }}
                </div><br /><br />
                <ng-container subHeader *ngIf="lastUpdatedDispute.status === DispStatus.New">
                  <h3>System flags</h3>
                </ng-container>
                <div class="col-lg-12" *ngIf="lastUpdatedDispute.status === DispStatus.New">
                  <span class="systemFlagList">Violation Ticket</span> <br />
                  <p *ngFor="let systemFlag of violationTicketService.ocrMessages" class="systemFlagList"><span
                      [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'fail' : 'success'"><span
                        [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'dot-fail' : 'dot'"></span>{{systemFlag.fieldConfidence
                      | percent:'1.1-1' }}</span>-<span
                      [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'fail-font-weight' : 'success-font-weight'">{{systemFlag.heading}}</span>
                  </p><br />
                  <span class="systemFlagList">Count 1</span> <br />
                  <p *ngFor="let systemFlag of violationTicketService.count1OcrMessages" class="systemFlagList"><span
                      [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'fail' : 'success'"><span
                        [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'dot-fail' : 'dot'"></span>{{systemFlag.fieldConfidence
                      | percent:'1.1-1' }}</span>-<span
                      [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'fail-font-weight' : 'success-font-weight'">{{systemFlag.heading}}</span>
                  </p><br />
                  <span class="systemFlagList">Count 2</span> <br />
                  <p *ngFor="let systemFlag of violationTicketService.count2OcrMessages" class="systemFlagList"><span
                      [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'fail' : 'success'"><span
                        [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'dot-fail' : 'dot'"></span>{{systemFlag.fieldConfidence
                      | percent:'1.1-1' }}</span>-<span
                      [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'fail-font-weight' : 'success-font-weight'">{{systemFlag.heading}}</span>
                  </p><br />
                  <span class="systemFlagList">Count 3</span> <br />
                  <p *ngFor="let systemFlag of violationTicketService.count3OcrMessages" class="systemFlagList"><span
                      [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'fail' : 'success'"><span
                        [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'dot-fail' : 'dot'"></span>{{systemFlag.fieldConfidence
                      | percent:'1.1-1' }}</span>-<span
                      [ngClass]="systemFlag.fieldConfidence < errorThreshold ? 'fail-font-weight' : 'success-font-weight'">{{systemFlag.heading}}</span>
                  </p><br />
                  <p class="systemFlagList"><span
                      [ngClass]="courtLocationFlag?.fieldConfidence < errorThreshold ? 'fail' : 'success'"><span
                        [ngClass]="courtLocationFlag?.fieldConfidence < errorThreshold ? 'dot-fail' : 'dot'"></span>{{courtLocationFlag?.fieldConfidence
                      | percent:'1.1-1' }}</span>-<span
                      [ngClass]="courtLocationFlag?.fieldConfidence < errorThreshold ? 'fail-font-weight' : 'success-font-weight'">{{courtLocationFlag?.heading}}</span>
                  </p><br />
                </div>
              </form>
            </section>
          </div>
        </div>
      </mat-expansion-panel>
      <div class="contact-info">
        <mat-expansion-panel [expanded]="true">
          <mat-expansion-panel-header (click)="handleCollapse('contactInformation')">
            <app-page-header>
              <ng-container subHeader>
                <span
                  *ngIf="lastUpdatedDispute.emailAddressVerified === true || !(lastUpdatedDispute.emailAddress)">Contact
                  Information </span>
                <span
                  *ngIf="lastUpdatedDispute.emailAddressVerified === false && lastUpdatedDispute.emailAddress">Contact
                  Information -- Email Address Not Verified </span>
                <i *ngIf="collapseObj?.contactInformation" class="fa fa-minus-circle"></i>
                <i *ngIf="!collapseObj?.contactInformation" class="fa fa-plus-circle"></i>
              </ng-container>
            </app-page-header>
          </mat-expansion-panel-header>
          <div class="contact-body">
            <br />
            <form (ngSubmit)="onSubmitNoticeOfDispute()" [formGroup]="form" novalidate>
              <section class="mb-2" style="width: 66%;">
                <div class="row">

                  <h4>Name on Ticket</h4>
                  <!-- Notice of Dispute surname -->
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>{{ "label.disputant_surname" | translate }}</mat-label>
                      <input matInput formControlName="disputantSurname" (change)="onFieldChange()" />
                      <mat-error *ngIf="form.controls.disputantSurname.hasError('required')">{{ "error.required" |
                        translate }}</mat-error>
                      <mat-error *ngIf="form.controls.disputantSurname.hasError('maxlength')">{{ "error.max_length" |
                        translate }}30</mat-error>
                    </mat-form-field>
                  </div>

                  <!-- Notice of dispute given names -->
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>{{ "label.disputant_given_names" | translate }}</mat-label>
                      <input matInput formControlName="disputantGivenNames" (change)="onFieldChange()" />
                      <mat-error *ngIf="form.controls.disputantGivenNames.hasError('required')">{{ "error.required" |
                        translate }}</mat-error>
                      <mat-error *ngIf="form.controls.disputantGivenNames.hasError('maxlength')">{{ "error.max_length" |
                        translate }}30 per name</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <section>
                  <div class="row">
                    <h4>{{ "label.who_contacting" | translate }}</h4>
                    <div class="col-md-6">
                      <mat-form-field class="w-100">
                        <mat-label>{{ "label.contact_type" | translate }}</mat-label>
                        <mat-select formControlName="contactTypeCd"
                          (selectionChange)="onSelectContactType($event.value)">
                          <mat-option [value]="ContactType.Individual">Individual on the ticket</mat-option>
                          <mat-option [value]="ContactType.Lawyer">Lawyer</mat-option>
                          <mat-option [value]="ContactType.Other">Other</mat-option>
                        </mat-select>
                        <mat-error>{{ "error.required" | translate }}</mat-error>
                      </mat-form-field>
                    </div>
                    <div class="col-md-6" *ngIf="form.get('contactTypeCd').value === ContactType.Lawyer">
                      <mat-form-field class="w-100">
                        <mat-label>{{ "label.name_of_law_firm" | translate }}</mat-label>
                        <input matInput formControlName="contactLawFirmNm" (change)="onFieldChange()" />
                        <mat-error *ngIf="form.controls.contactLawFirmNm.hasError('required')">{{ "error.required" |
                          translate }}</mat-error>
                        <mat-error *ngIf="form.controls.contactLawFirmNm.hasError('maxlength')">{{ "error.max_length" |
                          translate }}200</mat-error>
                      </mat-form-field>
                    </div>
                  </div>

                  <div class="row" *ngIf="form.get('contactTypeCd').value !== ContactType.Individual">

                    <!--Contact surname -->
                    <div class="col-md-6">
                      <mat-form-field class="w-100">
                        <mat-label>{{ "label.contact_surname" | translate }}</mat-label>
                        <input matInput formControlName="contactSurnameNm" (change)="onFieldChange()" />
                        <mat-error *ngIf="form.controls.contactSurnameNm.hasError('required')">{{ "error.required" |
                          translate }}</mat-error>
                        <mat-error *ngIf="form.controls.contactSurnameNm.hasError('maxlength')">{{ "error.max_length" |
                          translate }}30</mat-error>
                      </mat-form-field>
                    </div>

                    <!-- Contact given names -->
                    <div class="col-md-6">
                      <mat-form-field class="w-100">
                        <mat-label>{{ "label.contact_given_names" | translate }}</mat-label>
                        <input matInput formControlName="contactGivenNames" (change)="onFieldChange()" />
                        <mat-error *ngIf="form.controls.contactGivenNames.hasError('required')">{{ "error.required" |
                          translate }}</mat-error>
                        <mat-error *ngIf="form.controls.contactGivenNames.hasError('maxlength')">{{ "error.max_length" |
                          translate }}30 per name</mat-error>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">

                    <!-- Notice of dispute mailing address -->
                    <div class="col-md-6">
                      <mat-form-field class="w-100">
                        <mat-label>{{ "label.mailing_address" | translate }}</mat-label>
                        <input matInput formControlName="address" (change)="onFieldChange()"/>
                        <mat-error *ngIf="form.controls.address.hasError('required')">{{ "error.required" | translate
                          }}</mat-error>
                        <mat-error *ngIf="form.controls.address.hasError('maxlength')">{{ "error.max_length" | translate
                          }}100 per line</mat-error>
                      </mat-form-field>
                    </div>

                    <!-- Notice of dispute Country -->
                    <div class="col-md-6">
                      <mat-form-field class="w-100">
                        <mat-label>{{ "label.country" | translate }}</mat-label>
                        <mat-select formControlName="addressCountryId"
                          (selectionChange)="onCountryChange($event.value)">
                          <mat-option [value]="canada.ctryId">{{ canada.ctryLongNm }}</mat-option>
                          <mat-option [value]="usa.ctryId">{{ usa.ctryLongNm }}</mat-option>
                          <mat-option *ngFor="let country of config.countries" [value]="country.ctryId">{{
                            country.ctryLongNm }}</mat-option>
                        </mat-select>
                        <mat-error>{{ "error.required" | translate }}</mat-error>
                      </mat-form-field>
                    </div>
                  </div>

                  <div class="row">

                    <!-- Notice of dispute City -->
                    <div class="col-md-6">
                      <mat-form-field class="w-100">
                        <mat-label>{{ "label.city" | translate }}</mat-label>
                        <input matInput formControlName="addressCity" (change)="onFieldChange()"/>
                        <mat-error *ngIf="form.controls.addressCity.hasError('required')">{{ "error.required" |
                          translate }}</mat-error>
                        <mat-error *ngIf="form.controls.addressCity.hasError('maxlength')">{{ "error.max_length" |
                          translate }}30</mat-error>
                      </mat-form-field>
                    </div>

                    <!-- Notice of dispute province/state -->
                    <div class="col-md-6">
                      <mat-form-field class="w-100">
                        <mat-label *ngIf="form.get('addressCountryId').value===canada.ctryId">{{ "label.province" | translate }}</mat-label>
                        <mat-label *ngIf="form.get('addressCountryId').value===usa.ctryId">{{ "label.state" | translate }}</mat-label>
                        <mat-select formControlName="addressProvinceProvId"
                          (selectionChange)="onAddressProvinceChange($event.value)" (change)="onFieldChange()"
                          *ngIf="form.get('addressCountryId').value === canada.ctryId || form.get('addressCountryId').value === usa.ctryId">
                          <div *ngIf="form.get('addressCountryId').value === canada.ctryId">
                            <mat-option [value]="bc.provId">{{bc.provNm }}</mat-option>
                            <mat-option *ngFor="let province of provinces" [value]="province.provId">{{ province.provNm
                              }}
                            </mat-option>
                          </div>
                          <div *ngIf="form.get('addressCountryId').value === usa.ctryId">
                            <mat-option *ngFor="let state of states" [value]="state.provId">{{ state.provNm }}
                            </mat-option>
                          </div>
                        </mat-select>
                        <mat-label
                          *ngIf="form.get('addressCountryId').value!==usa.ctryId && form.get('addressCountryId').value !== canada.ctryId">
                          {{ "label.province_state" | translate }}</mat-label>
                        <input matInput formControlName="addressProvince" (change)="onFieldChange()"
                          *ngIf="form.get('addressCountryId').value !== usa.ctryId && form.get('addressCountryId').value !== canada.ctryId" />
                        <mat-error
                          *ngIf="form.controls.addressProvinceProvId.hasError('required')">{{
                          "error.required" | translate }}</mat-error>
                        <mat-error *ngIf="form.controls.addressProvince.hasError('maxlength')">{{ "error.max_length" |
                          translate }}30</mat-error>
                      </mat-form-field>
                    </div>
                  </div>
                </section>

                <div class="row">

                  <!-- Notice of dispute postal code -->
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label *ngIf="form.get('addressCountryId').value ===canada.ctryId">{{ "label.postal_code" | translate }}</mat-label>
                      <input matInput mask="S0S 0S0" oninput="this.value = this.value.toUpperCase()" minlength="6" (change)="onFieldChange()"
                        formControlName="postalCode" [showMaskTyped]="true"
                        *ngIf="form.get('addressCountryId').value===canada.ctryId" />
                      <mat-label *ngIf="form.get('addressCountryId').value===usa.ctryId">Zip Code</mat-label>
                      <input matInput mask="00000" oninput="this.value = this.value.toUpperCase()" (change)="onFieldChange()"
                        formControlName="postalCode" [showMaskTyped]="true"
                        *ngIf="form.get('addressCountryId').value===usa.ctryId" />
                      <mat-label
                        *ngIf="form.get('addressCountryId').value!==usa.ctryId && form.get('addressCountryId').value!==canada.ctryId">
                        {{ "label.postal_zip" | translate }}</mat-label>
                      <input matInput maxLength="6" oninput="this.value = this.value.toUpperCase()" (change)="onFieldChange()"
                        formControlName="postalCode"
                        *ngIf="form.get('addressCountryId').value!==usa.ctryId && form.get('addressCountryId').value !== canada.ctryId" />
                      <mat-error *ngIf="form.get('postalCode').hasError('required')">{{ "error.required" | translate }}</mat-error>
                      <mat-error
                        *ngIf="form.get('postalCode').hasError('pattern') || form.get('postalCode').hasError('minlength') || form.get('postalCode').hasError('maxlength')">
                        {{ "error.postal_zip" | translate }}
                      </mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <!--- Notice of dispute phone number -->
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>{{ "label.phone_number" | translate }}</mat-label>
                      <input matInput formControlName="homePhoneNumber" mask="(000) 000-0000" (change)="onFieldChange()"
                        *ngIf="form.get('addressCountryId').value === canada.ctryId || form.get('addressCountryId').value === usa.ctryId"
                        [showMaskTyped]="true" />
                      <input matInput formControlName="homePhoneNumber" mask="99999999999999999999" (change)="onFieldChange()"
                        *ngIf="form.get('addressCountryId').value !== canada.ctryId && form.get('addressCountryId').value !== usa.ctryId" />                      
                      <mat-error *ngIf="form.get('homePhoneNumber')?.hasError('phone')">{{ "error.phone_number" | translate }}
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <!-- Notice of dispute email address -->
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>{{ "label.email_address" | translate }}</mat-label>
                      <input matInput formControlName="emailAddress" autocomplete="off" (change)="onFieldChange()"/>
                      <mat-hint
                        *ngIf="lastUpdatedDispute.emailAddressVerified === false && lastUpdatedDispute.emailAddress"
                        style="color:red">
                        {{ "warning.unverified_email" | translate }}
                      </mat-hint>
                      <mat-error *ngIf="form.get('emailAddress').hasError('email')">{{"error.email_address" |
                        translate }}</mat-error>
                      <mat-error *ngIf="form.controls.emailAddress.hasError('maxlength')">{{"error.max_length" |
                        translate }}100</mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <br /><br />
                <div class="row">
                  <!-- Notice of dispute drivers licence province -->
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>{{ "label.dl_province" | translate }}</mat-label>
                      <mat-select formControlName="driversLicenceProvinceProvId"
                        (selectionChange)="onNoticeOfDisputeDLProvinceChange($event.value)">
                        <mat-option [value]=null></mat-option>
                        <mat-option [value]="bc.provId">{{bc.provNm}}</mat-option>
                        <mat-option *ngFor="let province of provinces" [value]="province.provId">{{ province.provNm }}
                        </mat-option>
                        <mat-option *ngFor="let state of states" [value]="state.provId">{{ state.provNm }}</mat-option>
                      </mat-select>
                      <mat-error>{{ "error.required" | translate }}</mat-error>
                    </mat-form-field>
                  </div>

                  <!-- Notice of dispute drivers licence number -->
                  <div class="col-md-6">
                    <mat-form-field class="w-100">
                      <mat-label>{{ "label.dl_number" | translate }}</mat-label>
                      <input matInput formControlName="driversLicenceNumber"
                        (keypress)="($event.charCode >= 48 && $event.charCode < 58)" (change)="onFieldChange()" minlength="7" maxlength="9"
                        *ngIf="form.get('driversLicenceProvinceProvId').value === bc.provId" />
                      <input matInput formControlName="driversLicenceNumber" maxlength="20"
                        *ngIf="form.get('driversLicenceProvinceProvId').value !== bc.provId" />
                      <mat-error *ngIf="form.get('driversLicenceNumber').hasError('required')">{{ "error.required" |
                        translate }}</mat-error>
                      <mat-error *ngIf="
                           form.get('driversLicenceNumber')?.errors?.minlength ||
                           form.get('driversLicenceNumber')?.errors?.maxlength">
                        {{ "error.dl_number" | translate }}
                      </mat-error>
                    </mat-form-field>
                  </div>
                </div>
                <div style="float: right; width: 100%;">
                  <button class="large" mat-flat-button type="button" color="primary"
                    (click)="resendEmailVerification()"
                    *ngIf="lastUpdatedDispute.emailAddressVerified === false && lastUpdatedDispute.emailAddress">
                    {{ "label.resend_email_verify" | translate}}
                  </button>
                  <button class="large" mat-flat-button type="submit" color="primary"
                    [disabled]="!enableNoticeOfDisputeSave()">
                    Save
                  </button>
                </div>
              </section>
            </form>
          </div>
        </mat-expansion-panel>
        <ng-container *ngIf="lastUpdatedDispute.emailAddressVerified === true || !(lastUpdatedDispute.emailAddress)">
          <app-ticket-request [disputeInfo]="lastUpdatedDispute"></app-ticket-request>
          <app-upload [disputeInfo]="lastUpdatedDispute"></app-upload>
          <div style="float: right; width: 100%;">
            <button class="large" mat-flat-button type="button" color="primary"
              [disabled]="(lastUpdatedDispute.status !== 'VALIDATED' && lastUpdatedDispute.status !== DispStatus.Rejected) || this.form.invalid || this.form.touched"
              (click)="approve()" style="background-color:  #2ba242;">
              Approve and submit to ARC
            </button>
            <button class="large" mat-flat-button type="button" color="primary" style="background-color: red;"
              (click)="reject()">
              Reject
            </button>
            <button class="large" mat-flat-button type="button" color="primary"
              [disabled]="lastUpdatedDispute.status !== DispStatus.Processing"
              (click)="cancel()">
              Cancel
            </button>
          </div>
        </ng-container>        
      </div>
    </div>
  </div>
</app-page>